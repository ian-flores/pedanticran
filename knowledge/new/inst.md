## Category: inst/ Directory

### INST-01: Hidden Files in inst/

- **Severity**: REJECTION
- **Rule**: Hidden files and OS-generated metadata must not be included in `inst/`. R CMD check flags these during "checking for hidden files and directories." Common offenders: `.DS_Store` (macOS Finder), `.gitkeep` (git empty-directory placeholder), `Thumbs.db` (Windows Explorer thumbnails), `desktop.ini` (Windows folder settings), `.Rhistory`, `.RData`.
- **CRAN says**: "Found the following hidden files and directories: inst/.DS_Store, inst/.gitkeep"
- **Detection**: Recursively scan `inst/` for files whose name starts with `.` or matches known OS metadata patterns: `.DS_Store`, `.gitkeep`, `.gitignore`, `Thumbs.db`, `desktop.ini`, `.Rhistory`, `.RData`.
- **Fix**: Delete hidden files from `inst/`. Add patterns to `.Rbuildignore` if they must exist at the project root level. Use `usethis::use_build_ignore()` for systematic exclusion.
- **Files**: `inst/**`

### INST-02: Deprecated CITATION Format (citEntry/personList)

- **Severity**: WARNING
- **Rule**: The `inst/CITATION` file must use modern `bibentry()` instead of the deprecated `citEntry()`. Similarly, `personList()` and `as.personList()` must be replaced with `c()` on person objects. `citHeader()` and `citFooter()` should be replaced with `header` and `footer` arguments to `bibentry()`. Since R 4.x these old-style functions generate NOTEs under `--as-cran` and CRAN reviewers increasingly reject packages using them.
- **CRAN says**: "Package CITATION file contains call(s) to old-style citEntry(). Please use bibentry() instead." / "Package CITATION file contains call(s) to old-style personList() or as.personList(). Please use c() on person objects instead."
- **Detection**: Read `inst/CITATION`. Search for `citEntry(`, `personList(`, `as.personList(`, `citHeader(`, `citFooter(` patterns.
- **Fix**: Replace `citEntry()` with `bibentry()` (use `bibtype` instead of `entry`). Replace `personList()` / `as.personList()` with `c()`. Replace `citHeader("text")` / `citFooter("text")` with `header = "text"` / `footer = "text"` arguments to the first `bibentry()` call.
- **Files**: `inst/CITATION`

### INST-03: inst/doc Conflicts with Vignette Building

- **Severity**: WARNING
- **Rule**: When a package has vignette sources in `vignettes/`, the `inst/doc/` directory should not exist in the source tree. Since R 3.1.0, `R CMD build` populates `inst/doc/` automatically from `vignettes/`. Manually placed files in `inst/doc/` create mismatches between source vignettes and built output. Vignette source files (`.Rmd`, `.Rnw`) must never be placed directly in `inst/doc/`.
- **CRAN says**: "inst/doc directory should not contain pre-built vignettes if vignettes/ directory exists" / "Package has a VignetteBuilder field but no prebuilt vignette index."
- **Detection**: Check if `vignettes/` exists with `.Rmd`/`.Rnw` source files. If `inst/doc/` also exists with `.html`/`.pdf`/`.Rmd`/`.Rnw` files, flag the conflict. Also flag `.Rmd` or `.Rnw` source files directly in `inst/doc/`.
- **Fix**: Delete `inst/doc/` from the source tree (it is regenerated by `R CMD build`). Move any vignette sources to `vignettes/`. Add `inst/doc` to `.gitignore` (but NOT to `.Rbuildignore`).
- **Files**: `inst/doc/`, `vignettes/`

### INST-04: Reserved Subdirectory Names and Embedded Packages in inst/

- **Severity**: REJECTION
- **Rule**: Contents of `inst/` are copied to the package installation root. Subdirectories of `inst/` must not use names reserved by R's package structure: `R`, `data`, `demo`, `exec`, `libs`, `man`, `help`, `html`, `Meta`. These would overwrite or conflict with R's standard directories during installation. Additionally, `inst/` must not contain embedded packages (subdirectories with their own DESCRIPTION file).
- **CRAN says**: "inst/ subdirectories should not interfere with R's standard directories" / "Subdirectory 'inst/tinytest/testpkg' appears to contain a package"
- **Detection**: List immediate subdirectories of `inst/` and flag any matching reserved names (case-sensitive). Recursively scan `inst/` for DESCRIPTION files indicating embedded packages.
- **Fix**: Rename conflicting directories to non-reserved names. For test fixture mock packages, restructure tests to avoid embedding packages inside `inst/`.
- **Files**: `inst/*/`

### INST-05: Missing Copyright Attribution for Bundled Third-Party Code

- **Severity**: WARNING
- **Rule**: Packages that bundle third-party JavaScript, CSS, C/C++ libraries, or other external code in `inst/` must properly attribute the original authors. CRAN Repository Policy requires: "Where code is copied (or derived) from the work of others, care must be taken that any copyright/license statements are preserved and authorship is not misrepresented." Common locations: `inst/htmlwidgets/lib/`, `inst/www/`, `inst/include/`, `inst/js/`, `inst/css/`.
- **CRAN says**: "Where copyrights are held by an entity other than the package authors, this should preferably be indicated via 'cph' roles in the 'Authors@R' field, or using a 'Copyright' field (if necessary referring to an inst/COPYRIGHTS file)."
- **Detection**: Check for common third-party code directories under `inst/` (`htmlwidgets/`, `www/`, `include/`, `js/`, `css/`). If found, check for: (1) `inst/COPYRIGHTS` file, (2) `Copyright` field in DESCRIPTION, (3) `cph` roles in Authors@R beyond the package authors, (4) LICENSE/LICENCE files within the third-party directories.
- **Fix**: Add copyright holders to Authors@R with `cph` role. Create `inst/COPYRIGHTS` file listing all bundled code and their licenses. Add `Copyright` field to DESCRIPTION referencing `inst/COPYRIGHTS`. Include LICENSE files alongside bundled code.
- **Files**: `inst/htmlwidgets/`, `inst/www/`, `inst/include/`, `inst/js/`, `inst/css/`, `DESCRIPTION`, `inst/COPYRIGHTS`

### INST-06: Large Files in inst/extdata

- **Severity**: WARNING
- **Rule**: CRAN imposes a 1MB per-subdirectory soft limit (any subdirectory exceeding 1MB triggers a NOTE in R CMD check "checking installed package size"). The `inst/extdata/` directory is a common location for example data and test fixtures. The overall package tarball should not exceed 5MB without special approval. This rule enhances existing SIZE-01 with per-subdirectory awareness.
- **CRAN says**: "installed size is X.XMb, sub-directories of 1Mb or more: extdata X.XMb"
- **Detection**: Calculate total size of each subdirectory under `inst/`. Flag any subdirectory exceeding 1MB. Flag individual files over 500KB. Identify potentially compressible files (uncompressed CSV, BMP images, uncompressed text).
- **Fix**: Compress data files (use xz or bzip2 for CSV/text). Reduce image resolution. Move large datasets to a separate data package. Use `tools::R_user_dir()` for runtime-downloaded data (R >= 4.0). Consider hosting data externally with download-on-demand.
- **Files**: `inst/extdata/`, `inst/*/`
